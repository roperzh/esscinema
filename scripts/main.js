window.App=window.App||{},App.Helper={debounce:function(e,t,n){var a,s,i,o,r,c=function(){var l=Date.now()-o;t>l&&l>0?a=setTimeout(c,t-l):(a=null,n||(r=e.apply(i,s),a||(i=s=null)))};return function(){i=this,s=arguments,o=Date.now();var l=n&&!a;return a||(a=setTimeout(c,t)),l&&(r=e.apply(i,s),i=s=null),r}},documentHeigth:function(){var e=document;return Math.max(e.body.scrollHeight,e.documentElement.scrollHeight,e.body.offsetHeight,e.documentElement.offsetHeight,e.body.clientHeight,e.documentElement.clientHeight)}},App.Ajax={request:function(e){var t=new XMLHttpRequest;t.open(e.method,e.url,!0),t.onload=function(){t.status>=200&&t.status<400?e.success(t.response):e.error(t.response)},t.onerror=function(){e.error(t.response)},t.send(e.data)},getScript:function(e,t){var n=document.createElement("script");n.type="text/javascript",n.src=e,n.async=!0,n.onload=t,document.body.appendChild(n)}},App.FacebookSdk={load:function(e){App.Ajax.getScript("//connect.facebook.net/"+e.lang+"/all.js",function(){FB.init({appId:e.appId,xfbml:!0,version:"v2.0"})})}},App.AnalyticsSdk={load:function(e){App.Ajax.getScript("//www.google-analytics.com/ga.js",function(){_gaq.push(["_setAccount","UA-"+e.appId+"-1"]),_gaq.push(["_trackPageview"])})}},App.FacebookShare=Essential.Behavior.extend({events:{click:"share"},init:function(){this.url=this.el.getAttribute("data-share-url")},share:function(e){e.preventDefault(),FB.ui({method:"share",href:this.url},function(e){"undefined"!=typeof e&&console.log(e)})}}),App.MovieSearcher=Essential.Behavior.extend({init:function(){this.apiKey=this.el.getAttribute("data-api-key"),this.baseUrl="https://api.themoviedb.org/3/search/movie?api_key="+this.apiKey,this.template=document.getElementById("testTemplate").innerHTML,this.compiler=doT.template(this.template),this.lazySearch=App.Helper.debounce(this.search,500),this.changeText({detail:{text:"h"}})},channels:{"search:textChanged #search-form":"changeText","end:reached":"loadNextPage"},changeText:function(e){this.page=1,this.text=e.detail.text,this.results=[],this.lazySearch()},loadNextPage:function(){this.page>=this.totalPages||(this.page+=1,this.search())},search:function(){App.Ajax.request({method:"GET",url:this.baseUrl+"&query="+this.text+"&search_type=ngram&page="+this.page,success:this.setContents.bind(this),error:function(e){console.log(e)}})},setContents:function(e){var t=JSON.parse(e);this.results=this.results.concat(t.results),this.el.innerHTML=this.compiler(this.results),this.totalPages=t.total_pages,Essential.loadBehaviors({application:App,context:this.el}),this.emit({channel:"search:performed",data:{count:t.total_results}})}}),App.SearchForm=Essential.Behavior.extend({events:{"keyup .search":"notify",submit:"stopSubmission"},notify:function(e){this.emit({channel:"search:textChanged",data:{text:e.currentTarget.value}})},stopSubmission:function(e){e.preventDefault()}}),App.StarsRating=Essential.Behavior.extend({init:function(){this.rating=this.el.getAttribute("data-rating"),this.el.className+=" star-"+Math.round(this.rating/2)},events:{"mouseover .fa-star":"markSelection",mouseout:"reset","click .fa-star":"sendVote"},markSelection:function(e){this.setStars(e.currentTarget.dataset.index)},reset:function(){this.setStars(Math.round(this.rating/2))},setStars:function(e){this.el.className=this.el.className.replace(/star-[0-9]/,"star-"+e)},sendVote:function(e){this.rating=2*parseInt(e.currentTarget.dataset.index)}}),App.ResultsBinding=Essential.Behavior.extend({channels:{"search:textChanged":"setText","search:performed":"setStat"},setText:function(e){this.el.getElementsByClassName("name")[0].innerHTML='"'+e.detail.text+'"'},setStat:function(e){this.el.getElementsByClassName("stat")[0].innerHTML=e.detail.count+" results"}}),App.TwitterShare=Essential.Behavior.extend({events:{click:"triggerClick"},triggerClick:function(e){e.preventDefault(),window.open(e.currentTarget.getAttribute("href"),"popUpWindow","width=800,height=270,left=10,top=10")}}),App.EndReachedChecker=Essential.Behavior.extend({init:function(){this.lazyEmit=App.Helper.debounce(this.emit,250)},events:{scroll:"check"},check:function(){App.Helper.documentHeigth()/this.el.scrollY<2&&this.lazyEmit({channel:"end:reached",context:document})}}),App.FacebookSdk.load({appId:"271828396337653",lang:"en_UK"}),App.AnalyticsSdk.load({appId:"51741194"}),document.addEventListener("DOMContentLoaded",function(){Essential.loadBehaviors({application:App}),App.EndReachedChecker.new(window)});